{"title":"基于koa-generator实现验证码功能","uid":"fe45cec90ec11b72673f92c41490ffd7","slug":"基于koa-generator实现验证码功能","date":"2022-03-05T02:56:54.000Z","updated":"2022-05-27T07:49:11.247Z","comments":true,"path":"api/articles/基于koa-generator实现验证码功能.json","keywords":null,"cover":[],"content":"<h3 id=\"第一步\"><a href=\"#第一步\" class=\"headerlink\" title=\"第一步\"></a>第一步</h3><ul>\n<li><p>全局安装<code>koa-generator</code></p>\n</li>\n<li><p>```shell<br>npm install -g koa-generator</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\n- 生成基本框架\n\n- &#96;&#96;&#96;shell\n  koa2 apiname    \n  # 使用koa2后面接目录名即可自动创建名为apiname的目录<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n<li><p>根据命令行提示，进入创建的文件夹，执行<code>npm install</code></p>\n</li>\n<li><p>```shell<br>cd apiname<br>npm install</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\n- 下载依赖完成之后，可以启动看看\n\n- &#96;&#96;&#96;shell\n  npm run start<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n<li><p>打开浏览器访问<code>3000</code>端口</p>\n</li>\n<li><p>```shell<br><a href=\"http://localhost:3000/\">http://localhost:3000</a></p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\n- 如果浏览器中页面显示出数据即创建成功，可以进入下一步\n\n\n\n### 第二步\n\n- 在根目录下新建&#96;src&#96;目录\n\n- 将&#96;public&#96; 、&#96;routes&#96; 、&#96;views&#96; 、&#96;app.js&#96;拖入&#96;src&#96;目录\n\n- 修改&#96;bin&#x2F;www&#96;中的&#96;var app &#x3D; require(&#39;..&#x2F;app&#39;);&#96;为&#96;var app &#x3D; require(&#39;..&#x2F;src&#x2F;app&#39;);&#96;\n\n- 改造后目录\n\n- &#96;&#96;&#96;shell\n  |- bin\n    |- www\n  |-node_modules\n  |-src\n    |-public\n    |-routes\n    |-views\n    |-app.js\n  |-package.json<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n<li><p>在<code>src</code>目录下创建目录<code>controller</code></p>\n</li>\n</ul>\n<h3 id=\"第三步\"><a href=\"#第三步\" class=\"headerlink\" title=\"第三步\"></a>第三步</h3><ul>\n<li><p>安装用于聚合router的包</p>\n</li>\n<li><p>安装<code>koa-combine-routers</code>包</p>\n</li>\n<li><p>```shell<br>npm install koa-combine-routers</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\n- 安装&#96;svg-captcha&#96;  包 用于生成&#96;svg&#96;验证码\n\n- &#96;&#96;&#96;shell\n  npm install svg-captcha<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n<li><p>在<code>controller</code>目录下创建<code>publicController.js</code> 用于生成验证码 并输入以下代码</p>\n</li>\n<li><p>```js<br>const svgCaptcha = require(“svg-captcha”);</p>\n<p>function  publicController(ctx) {<br>  //创建一个新验证码svg对象<br>  const newCaptcha = svgCaptcha.create({</p>\n<pre><code>size: 4,  //验证码长度\nignoreChars: &quot;0o1il&quot;, //排除易混淆的几个0o1il字符\ncolor: true,   //验证码有颜色\nnoise: Math.floor(Math.random() * 5), //干扰线\nwidth: 150,  \nheight: 50,\n</code></pre>\n<p>  });<br>  ctx.body = {</p>\n<pre><code>msg: newCaptcha.data,\n</code></pre>\n<p>  };<br>}</p>\n<p>module.exports = publicController;</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\n- 在&#96;routes&#96;目录下新建&#96;publicRouter.js &#96; 输入以下代码\n\n- &#96;&#96;&#96;js\n  const router &#x3D; require(&quot;koa-router&quot;)();\n  const getCaptcha &#x3D; require(&quot;..&#x2F;controller&#x2F;PublicController&quot;);\n  \n  router.get(&quot;&#x2F;getCaptcha&quot;, getCaptcha);\n  \n  module.exports &#x3D; router;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n<li><p>在<code>routes</code>目录下新建<code>routes.js</code> 输入以下代码</p>\n</li>\n<li><p>```js<br>const combineRoutes=require(‘koa-combine-routers’)</p>\n<p>const aRoutes=require(‘./publicRouter’)</p>\n<p>module.exports=combineRoutes(<br>  aRoutes   //如果有多个 可以引入多个，并写在此处用逗号隔开<br>)</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\n- 在&#96;app.js&#96;引入&#96;routes.js&#96; 并使用\n\n- &#96;&#96;&#96;js\n  const router &#x3D; require(&quot;.&#x2F;routes&#x2F;routes&quot;);\n  app.use(router())<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n<li><p>实现跨域请求，下载并引入<code>koa2-cors</code>包</p>\n</li>\n<li><p>```shell<br>npm install koa2-cors</p>\n<p>const cors = require(“koa2-cors”);</p>\n<p>//cors配置<br>app.use(<br>  cors({</p>\n<pre><code>origin: &quot;http://localhost:8080&quot;, //前端origin\ncredentials: true, //允许跨域带cookie\n</code></pre>\n<p>  })<br>);</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\n\n\n### 第四步\n\n使用&#96;vue&#96;项目，尝试请求验证码  下载&#96;axios&#96;包\n\n&#96;&#96;&#96;vue\n&lt;template&gt;\n\t&lt;div id&#x3D;&quot;app&quot;&gt;\n    &lt;div class&#x3D;&quot;svg&quot; @click&#x3D;&quot;getCaptcha&quot; v-html&#x3D;&quot;svg&quot;&gt;验证码&lt;&#x2F;div&gt;\n  &lt;&#x2F;div&gt;\n&lt;&#x2F;template&gt;\n\n&lt;script&gt;\nconst axios &#x3D; require(&#39;axios&#39;)\nexport default &#123;\n  name: &#39;app&#39;,\n  data () &#123;\n    return &#123;\n      svg: &#39;&#39;\n    &#125;\n  &#125;,\n  mounted () &#123;\n    this.getCaptcha()\n  &#125;,\n  methods: &#123;\n    getCaptcha () &#123;\n      axios.get(&#39;http:&#x2F;&#x2F;localhost:3000&#x2F;getCaptcha&#39;).then((res) &#x3D;&gt; &#123;\n        if (res.status &#x3D;&#x3D;&#x3D; 200) &#123;\n          this.svg &#x3D; res.data.msg\n        &#125;\n      &#125;)\n    &#125;\n  &#125;\n&#125;\n&lt;&#x2F;script&gt;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n</ul>\n<p><img src=\"https://raw.githubusercontent.com/liyunfuyyyy/img-url/master/202201112252049.png\" alt=\"image-20220111225233945\"></p>\n","text":"第一步 全局安装koa-generator ```shellnpm install -g koa-generator - 生成基本框架 - &#96;&#96;&#96;shell koa2 apiname # 使用koa2后面接目录名即可自动创建名为apiname的目录 根据命...","link":"","photos":[],"count_time":{"symbolsCount":"3.2k","symbolsTime":"3 mins."},"categories":[{"name":"实战","slug":"实战","count":5,"path":"api/categories/实战.json"}],"tags":[{"name":"Koa","slug":"Koa","count":1,"path":"api/tags/Koa.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%80%E6%AD%A5\"><span class=\"toc-text\">第一步</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%AC%AC%E4%B8%89%E6%AD%A5\"><span class=\"toc-text\">第三步</span></a></li></ol>","author":{"name":"LIYUNFU","slug":"blog-author","avatar":"https://p26-passport.byteacctimg.com/img/user-avatar/c52fbf24fbba8a052c8dd93e8b978eac~300x300.image","link":"/","description":"一个正在重塑知识的切图仔 <br /> @ <b>公众号:伯nulee</b>","socials":{"github":"https://gitee.com/LUNIONT","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/2277843824292183","customs":{}}},"mapped":true,"prev_post":{"title":"Webpack5搭建标准开发环境","uid":"417b0753cea51755f39f949bc1137c41","slug":"Webpack5搭建标准开发环境","date":"2022-03-05T03:00:17.000Z","updated":"2022-05-27T07:49:11.241Z","comments":true,"path":"api/articles/Webpack5搭建标准开发环境.json","keywords":null,"cover":[],"text":"Webpack安装&amp;使用安装npm install webpack webpack-cli -D 使用方式方式一.&#x2F;node_modules&#x2F;.bin&#x2F;webpack --version 方式二npx webpack --version 入口...","link":"","photos":[],"count_time":{"symbolsCount":"5.3k","symbolsTime":"5 mins."},"categories":[{"name":"实战","slug":"实战","count":5,"path":"api/categories/实战.json"}],"tags":[{"name":"Webpack","slug":"Webpack","count":1,"path":"api/tags/Webpack.json"},{"name":"前端工程化","slug":"前端工程化","count":1,"path":"api/tags/前端工程化.json"}],"author":{"name":"LIYUNFU","slug":"blog-author","avatar":"https://p26-passport.byteacctimg.com/img/user-avatar/c52fbf24fbba8a052c8dd93e8b978eac~300x300.image","link":"/","description":"一个正在重塑知识的切图仔 <br /> @ <b>公众号:伯nulee</b>","socials":{"github":"https://gitee.com/LUNIONT","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/2277843824292183","customs":{}}}},"next_post":{"title":"MongoDB的CRUD","uid":"2dd921bc2e0b67b467ed4b61518bdc3d","slug":"MongoDB的CRUD","date":"2022-03-05T02:54:11.000Z","updated":"2022-05-27T07:49:11.239Z","comments":true,"path":"api/articles/MongoDB的CRUD.json","keywords":null,"cover":[],"text":"MongoDB初见 Docker中MongoDB数据的备份与恢复#备份 docker exec -it 镜像名 mongodump -h 地址 -u root -p example -o 备份到的地址 docker exec -it some-mongo mongodump -h...","link":"","photos":[],"count_time":{"symbolsCount":"5.2k","symbolsTime":"5 mins."},"categories":[{"name":"实战","slug":"实战","count":5,"path":"api/categories/实战.json"}],"tags":[{"name":"MongoDB","slug":"MongoDB","count":1,"path":"api/tags/MongoDB.json"},{"name":"数据库","slug":"数据库","count":3,"path":"api/tags/数据库.json"},{"name":"Mongoose","slug":"Mongoose","count":1,"path":"api/tags/Mongoose.json"}],"author":{"name":"LIYUNFU","slug":"blog-author","avatar":"https://p26-passport.byteacctimg.com/img/user-avatar/c52fbf24fbba8a052c8dd93e8b978eac~300x300.image","link":"/","description":"一个正在重塑知识的切图仔 <br /> @ <b>公众号:伯nulee</b>","socials":{"github":"https://gitee.com/LUNIONT","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"https://juejin.cn/user/2277843824292183","customs":{}}}}}